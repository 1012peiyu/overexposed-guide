<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>éæ›ä¸–ä»£ï¼šäº’å‹•å¼æ¢ç´¢èˆ‡å¿ƒç†ç–«è‹—</title>
<!-- NOTE: ç‚ºäº†æœ€å¤§ç›¸å®¹æ€§ï¼Œæœ¬æª”æ¡ˆä¸ä¾è³´ä»»ä½•å¤–éƒ¨ JS åœ–è¡¨åº«ï¼›åœ–è¡¨ä»¥ Canvas åŸç”Ÿç¨‹å¼ç¹ªè£½ã€‚ä¿ç•™ Tailwind CDN åƒ…ä½œç‚ºæ¨£å¼åŠ åˆ†ï¼›è‹¥è¢«å°é–ï¼ŒåŠŸèƒ½ä»å¯é‹ä½œã€‚ -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
<script>
// Polyfills for older iOS Safari previewers
(function(){
  if(!NodeList.prototype.forEach){ NodeList.prototype.forEach = Array.prototype.forEach; }
  if(!Array.from){ Array.from = function(a){ return [].slice.call(a); } }
  if(!String.prototype.padStart){ String.prototype.padStart=function(n,chr){ var s=String(this); while(s.length<n){ s=(chr||' ')+s; } return s; } }
})();
</script>
<!-- Tailwind for better look (å¯è¢«å°é–ï¼›ä¸å½±éŸ¿åŠŸèƒ½) -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root{ --brand:#D35400; --ink:#4A4A4A; --bg:#FDFBF8; }
  html,body{height:100%}
  body{font-family:'Noto Sans TC',sans-serif;background:var(--bg);color:var(--ink)}
  .nav-link{transition:color .3s,border-bottom-color .3s;border-bottom:2px solid transparent}
  .nav-link:hover,.nav-link.active{color:var(--brand);border-bottom-color:var(--brand)}
  .tab.active{background-color:var(--brand);color:#fff}
  .tab:not(.active){background:#EAEAEA;color:var(--ink)}
  .btn-primary{background:var(--brand);color:#fff;transition:background .2s}
  .btn-primary:hover{background:#A04000}
  .btn-secondary{background:#839192;color:#fff}
  .btn-ghost{border:1px solid #ddd}
  .btn-danger{background:#ef4444;color:#fff}
  .btn-danger:hover{background:#dc2626}
  .chart-container{position:relative;width:100%;max-width:640px;margin:0 auto;height:320px}
  .shadow-soft{box-shadow:0 8px 24px rgba(0,0,0,.06)}
  .pill{border-radius:9999px;padding:.25rem .7rem;border:1px solid #e5e7eb;display:inline-flex;gap:.35rem;align-items:center}
  .pill.bad{background:#fee2e2;border-color:#fecaca}
  .pill.good{background:#dcfce7;border-color:#bbf7d0}
  canvas.doodle{touch-action:none;cursor:crosshair}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:1rem;z-index:60}
  details.theory-card summary::-webkit-details-marker{display:none}
  details.theory-card[open]{border-color:var(--brand)}
  .row-btn{border:1px solid #e5e7eb;padding:.3rem .55rem;border-radius:.5rem}
  .guide-step{display:none}
  .guide-step.active{display:block}
  .js-ok{position:fixed;right:.5rem;bottom:.5rem;background:#22c55e;color:#fff;font-size:.75rem;padding:.15rem .45rem;border-radius:.35rem;z-index:80}
  /* Basic fallback if Tailwind blocked */
  .container{max-width:1100px;margin:0 auto}
  .rounded-xl{border-radius:0.75rem} .rounded-2xl{border-radius:1rem}
  .border{border:1px solid #e5e7eb} .bg-white{background:#fff}
  .mb-16{margin-bottom:4rem} .mb-24{margin-bottom:6rem}
  .p-8{padding:2rem} .p-6{padding:1.5rem} .p-4{padding:1rem} .p-3{padding:.75rem} .px-6{padding-left:1.5rem;padding-right:1.5rem}
  .py-3{padding-top:.75rem;padding-bottom:.75rem} .py-4{padding-top:1rem;padding-bottom:1rem}
  .text-center{text-align:center} .text-xl{font-size:1.25rem} .text-3xl{font-size:1.875rem} .text-4xl{font-size:2.25rem} .text-5xl{font-size:3rem}
  .font-bold{font-weight:700} .font-semibold{font-weight:600}
  .max-w-3xl{max-width:48rem} .max-w-4xl{max-width:56rem} .max-w-5xl{max-width:64rem}
  .mx-auto{margin-left:auto;margin-right:auto}
  .hidden{display:none}
  @media (min-width:768px){ .md\:flex{display:flex} .md\:grid-cols-2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:1.5rem} }
</style>
</head>
<body class="antialiased">
<div id="jsOk" class="js-ok" style="display:none">JS OK</div>

<header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
  <nav class="container px-6 py-3 flex justify-between items-center">
    <div class="text-xl font-bold text-gray-800">éæ›ä¸–ä»£æŒ‡å—ï¼ˆv10.4 / Singleâ€‘fileï¼‰</div>
    <div class="hidden md:flex space-x-8">
      <a href="#challenge" class="nav-link">æ ¸å¿ƒæŒ‘æˆ°</a>
      <a href="#amplifier" class="nav-link">ç¶²è·¯æ”¾å¤§é¡</a>
      <a href="#motivation" class="nav-link">æ¨™ç±¤ç‰†</a>
      <a href="#vaccines" class="nav-link">å¿ƒç†ç–«è‹—</a>
      <a href="#wrap" class="nav-link">æ”¶æŸèˆ‡åŒ¯å‡º</a>
    </div>
  </nav>
</header>

<main class="container px-6 py-8 md:py-16">

  <section id="hero" class="text-center mb-16 md:mb-24">
    <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">çµ¦éæ›ä¸–ä»£çš„å¿ƒç†ç–«è‹—</h1>
    <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">
      åœ¨ä¸€å€‹å……æ»¿è©•åƒ¹èˆ‡é—œæ³¨çš„ä¸–ç•Œè£¡ï¼Œæˆ‘å€‘çš„å­©å­å¦‚ä½•å»ºç«‹å…§å¿ƒçš„å¯§éœèˆ‡å¾å®¹ï¼Ÿæœ¬æŒ‡å—å°‡å¸¶æ‚¨æ¢ç´¢ã€Œéæ›ä¸–ä»£ã€çš„å…§å¿ƒä¸–ç•Œï¼Œä¸¦æä¾›å¯¦ç”¨çš„æ–¹æ³•ï¼Œé™ªä¼´ä»–å€‘å¥åº·æˆé•·ã€‚
    </p>
  </section>

  <section id="challenge" class="mb-16 md:mb-24 scroll-mt-20">
    <h2 class="text-3xl font-bold text-center mb-2 text-gray-800">æ ¸å¿ƒæŒ‘æˆ°ï¼šä»£ä½è§€é»</h2>
    <p class="text-center text-gray-600 mb-8 max-w-2xl mx-auto">
      é’å°‘å¹´éåº¦åœ¨æ„ä»–äººçœ¼å…‰æ˜¯å¤©æ€§ï¼Œä½†å•é¡Œçš„æ ¹æºä¸åƒ…æ–¼æ­¤ã€‚ä»–å€‘è…¦ä¸­çš„ã€Œåˆ¥äººæ€éº¼çœ‹æˆ‘ã€ï¼Œå…¶å¯¦æ˜¯è‡ªå·±å°è‡ªå·±çš„åé —è©•åƒ¹ï¼ŒåŠ ä¸Šåœ¨æ„ä»–äººå¤©æ€§çš„æŠ•å°„ã€‚é€™å°±æ˜¯ã€Œä»£ä½è§€é»ã€ï¼Œä¹Ÿæ˜¯ç„¦æ…®çš„ä¸»è¦ä¾†æºã€‚
    </p>
    <div class="bg-white p-8 rounded-xl shadow-soft max-w-4xl mx-auto">
      <div class="flex flex-col md:flex-row items-center justify-center space-y-6 md:space-y-0 md:space-x-6 text-center">
        <div class="p-6 bg-amber-100 rounded-lg w-full md:w-1/3">
          <h3 class="text-xl font-semibold text-amber-800 mb-2">æˆåˆ†ä¸€ï¼šåœ¨æ„ä»–äºº</h3>
          <p class="text-amber-700">é€™æ˜¯é’æ˜¥æœŸçš„å¤©æ€§ï¼Œæ¸´æœ›è¢«åŒå„•æ¥ç´èˆ‡èªåŒã€‚</p>
        </div>
        <div class="text-4xl font-bold text-gray-400">+</div>
        <div class="p-6 bg-red-100 rounded-lg w-full md:w-1/3">
          <h3 class="text-xl font-semibold text-red-800 mb-2">æˆåˆ†äºŒï¼šåé —çš„è‡ªæˆ‘è©•åƒ¹</h3>
          <p class="text-red-700">é€™æ˜¯å•é¡Œçš„æ ¸å¿ƒï¼Œæºæ–¼å…§å¿ƒæ·±è™•ã€Œæ“”å¿ƒè‡ªå·±ä¸è¢«å–œæ­¡ã€ã€‚</p>
        </div>
        <div class="text-4xl font-bold text-gray-400">=</div>
        <div class="p-6 bg-blue-100 rounded-lg w-full md:w-1/3">
          <h3 class="text-xl font-semibold text-blue-800 mb-2">çµæœï¼šå…§å¿ƒç—›è‹¦</h3>
          <p class="text-blue-700">ã€Œåœ¨æƒ³åƒä¸­æ¯”åœ¨ç¾å¯¦ä¸­æ›´ç¶“å¸¸å—è‹¦ã€‚ã€- å¡å…§å¡</p>
        </div>
      </div>
    </div>
  </section>

  <section id="amplifier" class="mb-16 md:mb-24 scroll-mt-20">
    <h2 class="text-3xl font-bold text-center mb-2 text-gray-800">ç¶²è·¯æ”¾å¤§é¡ï¼šç¤¾ç¾¤å¦‚ä½•åŠ åŠ‡ç„¦æ…®</h2>
    <p class="text-center text-gray-600 mb-8 max-w-2xl mx-auto">
      ç¤¾ç¾¤åª’é«”å°‡äººéš›é—œä¿‚è®Šå¾—å…¬é–‹ä¸”ç›´æ¥ã€‚æ¯ä¸€æ¬¡ç™¼æ–‡ã€æ¯ä¸€å¼µç…§ç‰‡ï¼Œéƒ½æˆç‚ºè¢«è©•åƒ¹çš„å°è±¡ã€‚é€™ç¨®æŒçºŒçš„æ›å…‰ï¼Œè®“å­©å­ä¸æ–·é æ¼”ä»–äººçš„åæ‡‰ï¼Œå°‡ã€Œåœ¨æ„ä»–äººçœ¼å…‰ã€çš„ç„¦æ…®ç„¡é™æ”¾å¤§ã€‚
    </p>
    <div class="bg-white p-8 rounded-xl shadow-soft max-w-4xl mx-auto">
      <div class="chart-container">
        <canvas id="socialPressureChart"></canvas>
      </div>
      <p class="text-center text-sm text-gray-500 mt-4">åœ–è¡¨èªªæ˜ï¼šç›¸è¼ƒæ–¼ç¾å¯¦ç”Ÿæ´»ï¼Œç¶²è·¯ç¤¾ç¾¤å¤§å¹…å¢åŠ äº†æ¯æ—¥å¯èƒ½é¢è‡¨ä»–äººè©•åƒ¹çš„æ¬¡æ•¸èˆ‡å¼·åº¦ã€‚</p>
    </div>
  </section>

  <section id="motivation" class="mb-16 md:mb-24 scroll-mt-20">
    <h2 class="text-3xl font-bold text-center mb-3 text-gray-800">ğŸ·ï¸ å¼•èµ·å‹•æ©Ÿï¼šæ¨™ç±¤ç‰†</h2>
    <div class="bg-white p-8 rounded-xl shadow-soft max-w-5xl mx-auto">
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <div class="flex gap-3 mb-3">
            <input id="tagInput" class="flex-1 rounded-lg border px-3 py-2" placeholder="è¼¸å…¥è¢«è²¼éçš„æ¨™ç±¤ï¼Œä¾‹å¦‚ï¼šç»ç’ƒå¿ƒã€é‚Šç·£äººã€å¤ªå®‰éœâ€¦" />
            <select id="tagTone" class="rounded-lg border px-2 py-2">
              <option value="bad">ğŸ˜µ è² å‘</option>
              <option value="good">ğŸŒŸ æ­£å‘</option>
              <option value="neutral" selected>ğŸ˜¶ ä¸­æ€§</option>
            </select>
            <button id="addTagBtn" class="btn-primary rounded-lg px-4 py-2">æ–°å¢</button>
          </div>
          <div id="tagWall" class="min-h-[88px] p-3 border rounded-xl flex flex-wrap gap-3"></div>
        </div>
        <aside class="space-y-3">
          <div class="p-4 rounded-xl bg-amber-50">
            <div class="font-semibold mb-1">å¸¶é ˜å°æ’‡æ­¥</div>
            <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
              <li>å…è¨±åŒ¿åè²¼æ¨™ç±¤ã€‚</li>
              <li>æé†’ï¼šä¸è©•è«–ä»–äººå…§å®¹ï¼Œåªèªªè‡ªå·±çš„æ„Ÿå—ã€‚</li>
              <li>æ”¶æ–‚ï¼šè«‹å¤§å®¶è§€å¯Ÿç‰†ä¸Šé‡è¤‡åº¦æœ€é«˜çš„å­—è©ã€‚</li>
            </ul>
          </div>
          <div class="p-4 rounded-xl bg-blue-50">
            <div class="font-semibold mb-1">å»¶ä¼¸</div>
            <p class="text-sm text-gray-700">ä¸‹ä¸€æ­¥ã€Œæ¨™ç±¤åè½‰ã€æœƒç”¨åˆ°é€™äº›è² å‘æ¨™ç±¤ã€‚</p>
          </div>
        </aside>
      </div>
    </div>
  </section>

  <section id="vaccines" class="mb-16 md:mb-24 scroll-mt-20">
    <h2 class="text-3xl font-bold text-center mb-2 text-gray-800">ä¸‰ç¨®å¿ƒç†ç–«è‹—ï¼šå»ºç«‹å…§å¿ƒé˜²è­·ç¶²</h2>
    <p class="text-center text-gray-600 mb-8 max-w-2xl mx-auto">
      èˆ‡å…¶å‘Šè¨´å­©å­ã€Œä¸è¦åœ¨æ„ã€ï¼ˆé€™é•åå¤©æ€§ï¼‰ï¼Œä¸å¦‚ç‚ºä»–å€‘æ¥ç¨®ä¸‰ç¨®å¿ƒç†ç–«è‹—ï¼Œå¾æ ¹æœ¬å»ºç«‹å…§åœ¨åŠ›é‡ï¼Œå­¸ç¿’èˆ‡å¤–ç•Œçš„è©•åƒ¹å’Œå¹³å…±è™•ã€‚
    </p>
    <div class="max-w-5xl mx-auto">
      <div class="flex flex-wrap justify-center mb-6 border-b border-gray-200 gap-2">
        <button data-tab="tab1" class="tab text-lg font-medium py-3 px-6 rounded-t-lg -mb-px active">ğŸ§­ ç®¡ç†å¤–åœ¨èˆ‡æ³¨æ„åŠ›ï¼ˆç–«è‹—1ï¼‰</button>
        <button data-tab="tab2" class="tab text-lg font-medium py-3 px-6 rounded-t-lg -mb-px">ğŸ¯ èª¿æ•´å°è©•åƒ¹çš„èªçŸ¥ï¼ˆç–«è‹—2ï¼‹5ï¼‰</button>
        <button data-tab="tab3" class="tab text-lg font-medium py-3 px-6 rounded-t-lg -mb-px">ğŸ—ï¸ å»ºæ§‹ç©©å›ºçš„è‡ªæˆ‘ï¼ˆç–«è‹—3ï¼‹4ï¼‹6ï¼‰</button>
      </div>
      <div id="tabContent" class="bg-white p-8 rounded-xl shadow-soft min-h-[340px]"></div>
    </div>
  </section>

  <section id="wrap" class="mb-10 scroll-mt-20">
    <h2 class="text-3xl font-bold text-center mb-3 text-gray-800">ğŸ”š æ”¶æŸèˆ‡åŒ¯å‡º</h2>
    <div class="bg-white p-8 rounded-xl shadow-soft max-w-4xl mx-auto">
      <ul class="list-disc list-inside text-gray-700 leading-7">
        <li>å¤–åœ¨è¨Šæ¯å¯ç®¡ç†ï¼Œè©•åƒ¹å¯é‡è¿°ï¼Œè‡ªæˆ‘å¯å»ºæ§‹ã€‚</li>
        <li>æŠŠã€Œè¢«çœ‹è¦‹ã€çš„ç„¦æ…®ï¼Œè½‰ç‚ºã€Œè‡ªæˆ‘çœ‹è¦‹ã€çš„æ¸…æ¥šã€‚</li>
        <li>è‹¥æ™‚é–“æœ‰é™ï¼šç”¨ã€Œæ¨™ç±¤ç‰† â†’ åè½‰ â†’ å°ˆæ³¨ 1 åˆ†é˜ã€ä¹Ÿèƒ½å®Œæˆç²¾ç°¡ç‰ˆå¸¶è®€ã€‚</li>
      </ul>
      <div class="mt-5 flex flex-wrap gap-2 items-center">
        <button id="exportBtn" class="btn-ghost rounded-lg px-4 py-2">é è¦½ä¸¦åŒ¯å‡ºç´€éŒ„</button>
        <button id="clearAllBtn" class="btn-danger rounded-lg px-4 py-2">æ¸…é™¤æœ¬æ©Ÿæš«å­˜è³‡æ–™</button>
        <span id="exportHint" class="text-sm text-gray-500"></span>
      </div>
      <p class="text-xs text-gray-500 mt-2">æ¸…é™¤æœƒåˆªé™¤ï¼šæ¨™ç±¤ç‰†ã€åè½‰ç´€éŒ„ã€ä¸‰å±¤èªåŒã€æ¿¾é¡å·®è·ï¼ˆåƒ…æœ¬æ©Ÿç€è¦½å™¨ï¼‰ã€‚</p>
    </div>
  </section>

  <footer class="text-center py-8 border-t border-gray-200">
    <p class="text-gray-600">é€™æ˜¯ä¸€å€‹åŸºæ–¼ã€Šéæ›ä¸–ä»£ã€‹è®€æ›¸æœƒè³‡æ–™æ‰€å‰µå»ºçš„äº’å‹•å¼æŒ‡å—ã€‚</p>
    <p class="text-sm text-gray-500 mt-2">ç‚ºå®¶é•·èˆ‡æ•™è‚²è€…æä¾›æ”¯æŒï¼Œå…±åŒé™ªä¼´å­©å­æˆé•·ã€‚</p>
  </footer>
</main>

<!-- åŒ¯å‡º Modal -->
<div id="exportModal" class="modal">
  <div class="bg-white rounded-2xl shadow-soft max-w-3xl w-full">
    <div class="px-6 py-4 border-b flex justify-between items-center">
      <h3 class="font-semibold text-lg">åŒ¯å‡ºé è¦½</h3>
      <button id="closeModal" class="text-gray-500 hover:text-gray-700">âœ•</button>
    </div>
    <div class="p-6 space-y-3">
      <textarea id="exportText" rows="12" class="w-full border rounded-lg px-3 py-2 font-mono text-sm"></textarea>
      <div class="flex flex-wrap gap-2">
        <button id="copyBtn" class="btn-primary rounded-lg px-3 py-2">è¤‡è£½åˆ°å‰ªè²¼ç°¿</button>
        <button id="dlTxtUtf8" class="btn-ghost rounded-lg px-3 py-2">ä¸‹è¼‰ TXTï¼ˆUTFâ€‘8ï¼‰</button>
        <button id="dlTxtBom" class="btn-ghost rounded-lg px-3 py-2">ä¸‹è¼‰ TXTï¼ˆUTFâ€‘8 + BOMï¼‰</button>
        <button id="dlMd" class="btn-ghost rounded-lg px-3 py-2">ä¸‹è¼‰ Markdown</button>
        <button id="dlCsv" class="btn-ghost rounded-lg px-3 py-2">ä¸‹è¼‰ CSV</button>
      </div>
      <p class="text-xs text-gray-500">è‹¥ç€è¦½å™¨é˜»æ“‹ä¸‹è¼‰ï¼Œè«‹å…ˆæŒ‰ã€Œè¤‡è£½åˆ°å‰ªè²¼ç°¿ã€ï¼Œå†è²¼åˆ°ä»»ä½•æ–‡å­—ç·¨è¼¯å™¨å¦å­˜ã€‚</p>
    </div>
  </div>
</div>

<!-- å¼•å° Modal -->
<div id="guideModal" class="modal">
  <div class="bg-white rounded-2xl shadow-soft max-w-3xl w-full">
    <div class="px-6 py-4 border-b flex justify-between items-center">
      <h3 class="font-semibold text-lg">æ•´åˆå¼•å°ç‰ˆæœ¬ï¼šå¿ƒç†å­¸ Ã— æ“ä½œæ•™å­¸</h3>
      <button id="closeGuide" class="text-gray-500 hover:text-gray-700">âœ•</button>
    </div>
    <div class="p-6">
      <div class="flex flex-wrap gap-2 mb-4">
        <button class="row-btn guide-nav" data-step="1">Step 1ï½œCore</button>
        <button class="row-btn guide-nav" data-step="2">Step 2ï½œRole</button>
        <button class="row-btn guide-nav" data-step="3">Step 3ï½œImage</button>
        <button class="row-btn guide-nav" data-step="4">æ•´é«”æª¢æ ¸</button>
      </div>
      <div id="guideStep1" class="guide-step">
        <h4 class="font-semibold mb-1">Step 1ï½œCoreï¼ˆå€‹äººåƒ¹å€¼æ¸…å–®ï¼‰</h4>
        <h5 class="mt-2 font-semibold text-gray-800">æç¤ºæ–‡å­—ï¼ˆæ“ä½œå¼•å°ï¼‰</h5>
        <ul class="list-disc list-inside text-gray-700 mt-1 space-y-1">
          <li>å…ˆåˆ—å‡ºä½ è¦ºå¾—é‡è¦çš„åƒ¹å€¼è§€ï¼ˆå¦‚ã€Œèª å¯¦ã€ã€Œå‰µé€ åŠ›ã€ã€Œé—œæ‡·ã€ï¼‰ï¼Œä½ å¯ä»¥æ–°å¢ã€åˆªé™¤ã€èª¿æ•´é †åºã€‚</li>
          <li>æ¯é€±å‹¾é¸ã€Œæœ¬é€±æ ¸å¿ƒåƒ¹å€¼ã€ï¼Œå®ƒå°‡æˆç‚ºä½ é€™é€±çš„è¡Œå‹•æŒ‡å—ã€‚</li>
        </ul>
        <h5 class="mt-3 font-semibold text-gray-800">å¿ƒç†å­¸å°å¡ï¼ˆç†è«–è§£èªªï¼‰</h5>
        <p class="text-gray-700"><b>ç‚ºä»€éº¼è¦åšï¼Ÿ</b> é€™æ˜¯ã€Œåƒ¹å€¼æ¾„æ¸…æ³•ã€çš„ä¸€éƒ¨åˆ†ã€‚ç•¶ä½ æ¸…æ¥šä»€éº¼å°ä½ æœ€é‡è¦ï¼Œä½ çš„è¡Œå‹•æœƒæ›´æœ‰æ–¹å‘ï¼Œä¸å®¹æ˜“è¢«å¤–ç•Œçš„è©•åƒ¹å¸¶èµ°ç„¦é»ã€‚</p>
        <div class="mt-2 p-3 bg-gray-50 rounded-lg">
          <div class="text-gray-700"><b>å°æ‡‰ç†è«–ï¼š</b></div>
          <ul class="list-disc list-inside text-gray-700 mt-1 space-y-1">
            <li>åƒ¹å€¼æ¾„æ¸…æ³•ï¼ˆValues Clarificationï¼‰</li>
            <li>è‡ªæˆ‘æ±ºå®šç†è«–ï¼ˆSelf-Determination Theoryï¼‰</li>
            <li>ACT æ¥å—èˆ‡æ‰¿è«¾æ²»ç™‚ï¼ˆAcceptance & Commitment Therapyï¼‰</li>
          </ul>
        </div>
      </div>
      <div id="guideStep2" class="guide-step">
        <h4 class="font-semibold mb-1">Step 2ï½œRoleï¼ˆç¤¾æœƒè§’è‰²èˆ‡è¡Œç‚ºè¦å‰‡ï¼‰</h4>
        <h5 class="mt-2 font-semibold text-gray-800">æç¤ºæ–‡å­—ï¼ˆæ“ä½œå¼•å°ï¼‰</h5>
        <ul class="list-disc list-inside text-gray-700 mt-1 space-y-1">
          <li>è¼¸å…¥ä½ åœ¨ç”Ÿæ´»ä¸­æ‰®æ¼”çš„è§’è‰²ï¼ˆå¦‚ã€Œè€å¸«ã€ã€Œæœ‹å‹ã€ã€Œå®¶äººã€ï¼‰ï¼Œæ¯å€‹è§’è‰²è¨­å®šä¸€æ¢è¡Œç‚ºè¦å‰‡ã€‚</li>
          <li>ä¸ç¢ºå®šæ€éº¼å¯«ï¼Ÿé»ã€Œç”¨æ ¸å¿ƒåƒ¹å€¼è‡ªå‹•å¥—ç‰ˆã€ï¼Œç³»çµ±æœƒç”¨ä½ å‰›å‰›é¸çš„åƒ¹å€¼å¹«ä½ ç”Ÿå‡ºä¸€å¥è©±ï¼ˆå¦‚ã€Œä½œç‚ºæœ‹å‹ï¼Œæˆ‘æœƒé€éèª å¯¦å‚¾è½ä¾†å»ºç«‹ä¿¡ä»»ã€ï¼‰ï¼Œå†è‡ªå·±å¾®èª¿ã€‚</li>
        </ul>
        <h5 class="mt-3 font-semibold text-gray-800">å¿ƒç†å­¸å°å¡ï¼ˆç†è«–è§£èªªï¼‰</h5>
        <p class="text-gray-700"><b>ç‚ºä»€éº¼è¦åšï¼Ÿ</b> æˆ‘å€‘æ¯å¤©åœ¨ä¸åŒå ´åˆåˆ‡æ›è§’è‰²ï¼Œå¦‚æœè§’è‰²ä¹‹é–“çš„è¡Œç‚ºèˆ‡åƒ¹å€¼ä¸€è‡´ï¼Œå°±èƒ½æ¸›å°‘å…§åœ¨è¡çªï¼Œæ´»å¾—æ›´ç©©å®šã€‚</p>
        <div class="mt-2 p-3 bg-gray-50 rounded-lg">
          <div class="text-gray-700"><b>å°æ‡‰ç†è«–ï¼š</b></div>
          <ul class="list-disc list-inside text-gray-700 mt-1 space-y-1">
            <li>ç¤¾æœƒè§’è‰²ç†è«–ï¼ˆSocial Role Theoryï¼‰</li>
            <li>è§’è‰²èªåŒç†è«–ï¼ˆRole Identity Theoryï¼‰</li>
            <li>é¡ä¸­è‡ªæˆ‘ï¼ˆLooking-Glass Selfï¼‰</li>
          </ul>
        </div>
      </div>
      <div id="guideStep3" class="guide-step">
        <h4 class="font-semibold mb-1">Step 3ï½œImageï¼ˆå½¢è±¡èªåŒï¼‰</h4>
        <h5 class="mt-2 font-semibold text-gray-800">æç¤ºæ–‡å­—ï¼ˆæ“ä½œå¼•å°ï¼‰</h5>
        <ul class="list-disc list-inside text-gray-700 mt-1 space-y-1">
          <li>è¼¸å…¥ä½ å¸Œæœ›åˆ¥äººçœ‹åˆ°çš„å½¢è±¡ï¼ˆå¦‚ã€Œå°ˆæ¥­è€Œæº«æš–ã€ã€Œæœ‰å‰µæ„çš„è¡Œå‹•è€…ã€ï¼‰ã€‚</li>
          <li>åŒ¯å‡ºæ™‚ï¼Œç³»çµ±æœƒå°‡å®ƒèˆ‡ Core / Role ä¸€èµ·é¡¯ç¤ºï¼Œè®“ä½ æª¢æŸ¥å½¢è±¡æ˜¯å¦èˆ‡åƒ¹å€¼ã€è§’è‰²è¡Œç‚ºä¸€è‡´ã€‚</li>
        </ul>
        <h5 class="mt-3 font-semibold text-gray-800">å¿ƒç†å­¸å°å¡ï¼ˆç†è«–è§£èªªï¼‰</h5>
        <p class="text-gray-700"><b>ç‚ºä»€éº¼è¦åšï¼Ÿ</b> å½¢è±¡æ˜¯ä¸€ç¨®ã€Œå°å¤–çš„æˆ‘ã€ã€‚å¦‚æœå®ƒèˆ‡å…§å¿ƒåƒ¹å€¼ä¸ä¸€è‡´ï¼Œä½ æœƒè¦ºå¾—ç–²ç´¯ã€è™›å‡ã€‚ç•¶å®ƒå’Œåƒ¹å€¼ã€è§’è‰²å°é½Šï¼Œä½ çš„è‡ªæˆ‘æ¦‚å¿µæœƒæ›´æ¸…æ™°ï¼Œä¹Ÿæ›´è‡ªä¿¡ã€‚</p>
        <div class="mt-2 p-3 bg-gray-50 rounded-lg">
          <div class="text-gray-700"><b>å°æ‡‰ç†è«–ï¼š</b></div>
          <ul class="list-disc list-inside text-gray-700 mt-1 space-y-1">
            <li>å½¢è±¡ç®¡ç†ï¼ˆImpression Managementï¼‰</li>
            <li>è‡ªæˆ‘æ¦‚å¿µæ¸…æ™°åº¦ï¼ˆSelf-Concept Clarityï¼‰</li>
            <li>ç¤¾æœƒèªåŒç†è«–ï¼ˆSocial Identity Theoryï¼‰</li>
          </ul>
        </div>
      </div>
      <div id="guideStep4" class="guide-step">
        <h4 class="font-semibold mb-2">æ•´é«”æª¢æ ¸å¼•å°</h4>
        <p class="text-gray-700">æ­å–œå®Œæˆï¼ç¾åœ¨çœ‹çœ‹ä½ çš„ã€Œåƒ¹å€¼ â†’ è§’è‰² â†’ å½¢è±¡ã€ä¸‰è€…æ˜¯å¦å°é½Šï¼š</p>
        <ul class="list-disc list-inside text-gray-700 mt-1 space-y-1">
          <li>ä½ çš„å½¢è±¡èƒ½åæ˜ å‡ºä½ çš„æ ¸å¿ƒåƒ¹å€¼å—ï¼Ÿ</li>
          <li>ä½ çš„æ¯å€‹è§’è‰²è¡Œç‚ºï¼Œæ˜¯å¦éƒ½æ”¯æ´ä½ æƒ³è¦å‘ˆç¾çš„å½¢è±¡ï¼Ÿ</li>
          <li>å¦‚æœä¸‰è€…æœ‰è¡çªï¼Œå“ªä¸€å¡Šéœ€è¦èª¿æ•´ï¼Ÿ</li>
        </ul>
        <div class="mt-3 p-3 bg-gray-50 rounded-lg">
          <div class="text-gray-700"><b>å¿ƒç†å­¸å°å¡ï¼š</b></div>
          <p class="text-gray-700 mt-1">é€™æ˜¯ä¸€å€‹ã€Œè‡ªæˆ‘èªåŒæ ¡æº–ã€çš„éç¨‹ï¼š</p>
          <ul class="list-disc list-inside text-gray-700 mt-1 space-y-1">
            <li><b>åƒ¹å€¼</b>æ˜¯æ–¹å‘æ„Ÿ</li>
            <li><b>è§’è‰²è¡Œç‚º</b>æ˜¯è½åœ°æ–¹å¼</li>
            <li><b>å½¢è±¡</b>æ˜¯å°å¤–å‘ˆç¾</li>
          </ul>
          <p class="text-gray-700 mt-1">ç•¶ä¸‰è€…ä¸€è‡´æ™‚ï¼Œä½ æœƒæ„Ÿè¦ºæ›´æœ‰åŠ›é‡ã€æ›´ç©©å®šã€‚</p>
        </div>
        <div class="mt-4">
          <h5 class="font-semibold mb-1">å°é½Šæª¢æ ¸åœ–</h5>
          <p class="text-gray-700 mb-2">ä»¥ 0â€“100 åˆ†å‘ˆç¾ä¸‰å€‹ä¸€è‡´åº¦ï¼šCoreâ†”Roleã€Coreâ†”Imageã€Roleâ†”Imageï¼ˆä¾æ–‡å­—ç›¸ä¼¼åº¦ä¼°è¨ˆï¼‰ã€‚</p>
          <div class="chart-container" style="max-width:520px;height:320px">
            <canvas id="alignRadar"></canvas>
          </div>
          <p id="alignText" class="text-gray-700 mt-3"></p>
        </div>
      </div>
      <div class="mt-5 flex justify-between">
        <button id="prevStep" class="row-btn">â† ä¸Šä¸€æ­¥</button>
        <button id="nextStep" class="row-btn">ä¸‹ä¸€æ­¥ â†’</button>
      </div>
    </div>
  </div>
</div>

<!-- TABS å…§å®¹æ¨£æ¿ -->
<template id="tab1-tpl">
  <div class="grid md:grid-cols-2 gap-6">
    <div class="space-y-6">
      <div class="rounded-2xl border p-5 text-center">
        <h3 class="text-xl font-semibold mb-1">ğŸ§˜ å°ˆæ³¨åŠ›ç·´ç¿’ï¼šä¸€åˆ†é˜æŒ‘æˆ°</h3>
        <p class="text-gray-600 mb-4">é–‰ä¸Šçœ¼ç›åœ¨å¿ƒä¸­é»˜æ•¸ï¼Œç•¶ä½ è¦ºå¾—ä¸€åˆ†é˜åˆ°äº†å°±æŒ‰ã€ŒçµæŸã€ã€‚</p>
        <div id="timerDisplay" class="text-6xl font-bold text-gray-800 mb-6">00:00</div>
        <div id="timerControls">
          <button id="startTimerBtn" class="btn-primary font-bold py-3 px-8 rounded-full text-lg">é–‹å§‹</button>
        </div>
        <div id="timerResult" class="mt-6 text-lg text-gray-700"></div>
      </div>

      <div>
        <h3 class="text-xl font-semibold">ğŸ¨ çºç¹ç•«ï¼ˆZentangleï¼‰</h3>
        <p class="text-gray-700 mb-2">åœ¨ä¸‹æ–¹ç•«å¸ƒä¸Šé‡è¤‡ç°¡å–®ç·šæ¢æˆ–å¹¾ä½•åœ–å½¢ï¼Œè®“å¤§è…¦é€²å…¥ç©©å®šç¯€å¥ã€‚</p>
        <div class="flex gap-2 mb-2">
          <button id="startDoodle" class="btn-ghost rounded-lg px-3 py-2">é–‹å§‹ç¹ªè£½</button>
          <button id="clearDoodle" class="btn-ghost rounded-lg px-3 py-2">æ¸…é™¤</button>
        </div>
        <canvas id="doodleCanvas" class="border rounded-xl w-full doodle bg-white" style="height:320px;"></canvas>
      </div>
    </div>

    <div class="space-y-4">
      <h3 class="text-xl font-semibold">ğŸ¥œ æ­£å¿µåƒå …æœï¼ˆæˆ–è‘¡è„ä¹¾ï¼‰</h3>
      <ol class="list-decimal list-inside text-gray-700 space-y-1">
        <li>å…ˆä¸åƒï¼Œ<b>åªçœ‹</b>ï¼šè§€å¯Ÿå½¢ç‹€ã€é¡è‰²ã€ç´‹ç†ã€‚</li>
        <li><b>å—…è</b>ï¼šæ³¨æ„é¦™æ°£å¼·å¼±ã€è®ŠåŒ–ã€‚</li>
        <li><b>å…¥å£ä¸å’¬</b>ï¼šæ„Ÿå—é‡é‡ã€æº«åº¦ã€å£æ„Ÿã€‚</li>
        <li><b>ç·©æ…¢å’€åš¼</b>ï¼šç•™æ„ç ´è£‚è²èˆ‡å‘³é“æ“´æ•£ã€‚</li>
        <li><b>ååš¥å¾Œ</b>ï¼šè¦ºå¯Ÿé¤˜å‘³èˆ‡èº«é«”è¨Šè™Ÿã€‚</li>
      </ol>
      <div class="p-4 rounded-xl bg-emerald-50 text-gray-700">
        <b>å¸¶é ˜æé†’ï¼š</b>é€™ä¸æ˜¯åƒé›¶é£Ÿï¼Œè€Œæ˜¯ç·´ç¿’æŠŠæ³¨æ„åŠ›æ”¾å›è‡ªå·±çš„æ„Ÿå®˜ã€‚
      </div>
    </div>
  </div>
</template>

<template id="tab2-tpl">
  <div class="flex items-center justify-between flex-wrap gap-2 mb-4">
    <h3 class="text-xl font-semibold">ğŸ¯ èª¿æ•´å°è©•åƒ¹çš„èªçŸ¥ï¼ˆç–«è‹—2ï¼‹5ï¼‰</h3>
  </div>
  <div class="grid md:grid-cols-2 gap-6">
    <div class="space-y-4">
      <h4 class="text-lg font-semibold">ğŸ”„ æ¨™ç±¤åè½‰ï¼ˆä½¿ç”¨ä¸Šæ–¹æ¨™ç±¤ç‰†ï¼‰</h4>
      <p class="text-gray-700">é¸æ“‡ä¸€å¼µã€Œè² å‘ã€æ¨™ç±¤ï¼Œå˜—è©¦æŠŠå®ƒæ”¹å¯«æˆè³‡æºæˆ–è¨Šè™Ÿã€‚</p>
      <div class="flex gap-2">
        <button id="pickBadTag" class="btn-ghost rounded-lg px-3 py-2">å¾æ¨™ç±¤ç‰†æŠ½ä¸€å¼µè² å‘æ¨™ç±¤</button>
        <span id="pickedTag" class="pill">å°šæœªæŠ½å–</span>
      </div>
      <div class="mt-2">
        <label class="text-sm text-gray-600">åè½‰å¾Œçš„æ–°æ•˜äº‹</label>
        <input id="flipRewrite" class="w-full rounded-lg border px-3 py-2" placeholder="ä¾‹å¦‚ï¼šã€ç»ç’ƒå¿ƒã€â†’ã€é«˜åº¦æ•éŠ³ã€èƒ½åŒç†ä»–äººã€" />
        <div class="mt-2 flex gap-2 flex-wrap items-center">
          <button id="saveFlip" class="btn-primary rounded-lg px-3 py-2">å„²å­˜åè½‰</button>
          <button id="cancelEdit" class="btn-ghost rounded-lg px-3 py-2 hidden">å–æ¶ˆç·¨è¼¯</button>
          <span id="flipSavedHint" class="text-sm text-gray-500"></span>
        </div>
      </div>
      <div class="p-4 rounded-xl bg-blue-50 text-gray-700">
        <b>æç¤ºï¼š</b>è«‹ä½¿ç”¨ã€Œäº‹å¯¦ â†’ è©®é‡‹ â†’ è¡Œå‹•ã€ä¸‰æ­¥é©Ÿï¼šæˆ‘è§€å¯Ÿåˆ°___ï¼›æˆ‘å¯ä»¥æ›¿ä»£æ€§è©®é‡‹___ï¼›æˆ‘ä¸‹ä¸€æ­¥æœƒ___ã€‚
      </div>
    </div>
    <div class="space-y-4">
      <h4 class="text-lg font-semibold">ğŸƒ FLIP åè½‰å¡ï¼ˆè¿·ä½ ç‰ˆï¼‰</h4>
      <p class="text-gray-700">æŠ½ä¸€å¼µå¡ï¼Œå¥—ç”¨åœ¨å‰›å‰›é‚£å€‹æ¨™ç±¤äº‹ä»¶ä¸Šã€‚</p>
      <div class="flex gap-2">
        <button id="drawFlipCard" class="btn-ghost rounded-lg px-3 py-2">æŠ½å¡</button>
        <span id="flipCard" class="pill">å°šæœªæŠ½å¡</span>
      </div>
      <ul id="flipCardGuide" class="list-disc list-inside text-gray-700 mt-2 space-y-1"></ul>
      <div class="p-4 rounded-xl bg-amber-50 text-gray-700"><b>èªªæ˜ï¼š</b>ç¤ºç¯„å¡ï¼Œè‹¥æœ‰æ­£å¼æ¡ŒéŠè«‹ä¾è¦å‰‡ã€‚</div>
      <div class="mt-4">
        <h4 class="font-semibold">ğŸ“„ å·²å„²å­˜çš„åè½‰ç´€éŒ„</h4>
        <ul id="flipList" class="text-gray-700 mt-1 space-y-2"></ul>
      </div>
    </div>
  </div>
</template>

<template id="tab3-tpl">
  <div class="space-y-8">
    <div>
      <div class="flex items-center justify-between flex-wrap gap-2 mb-2">
        <h3 class="text-xl font-semibold">ğŸ“š ç†è«–å°å¡ï¼ˆé¡ä¸­è‡ªæˆ‘ â†’ è‡ªæˆ‘æ±ºå®šç†è«– â†’ è‡ªæˆ‘æ¦‚å¿µæ¸…æ™°åº¦ï¼‰</h3>
        <div class="flex gap-2">
          <button id="openGuide" class="row-btn">ğŸ§­ é–‹å•Ÿå¼•å°æ¨¡å¼</button>
        </div>
      </div>
      <div class="grid md:grid-cols-2 gap-4">
        <details class="theory-card border rounded-xl p-4 bg-white open:shadow-soft">
          <summary class="cursor-pointer flex items-center gap-2 select-none"><span class="text-2xl">ğŸª</span><span class="font-semibold">é¡ä¸­è‡ªæˆ‘ï¼ˆCooleyï¼‰</span></summary>
          <div class="mt-3 text-gray-700 space-y-2">
            <div><b>æ ¸å¿ƒæ¦‚å¿µï¼š</b>æˆ‘å€‘é€éæƒ³åƒåˆ¥äººæ€éº¼çœ‹æˆ‘å€‘ï¼Œä¾†å½¢å¡‘è‡ªæˆ‘å½¢è±¡ï¼›æµç¨‹åŒ…å«ã€Œæƒ³åƒä»–äººçœ¼ä¸­çš„æˆ‘ã€â†’ã€Œæƒ³åƒä»–äººçš„è©•åƒ¹ã€â†’ã€Œæ“šæ­¤ç”¢ç”Ÿæƒ…ç·’èˆ‡è‡ªæˆ‘æ”¹è®Šã€ã€‚</div>
            <div class="p-3 bg-blue-50 rounded-lg"><b>ç”Ÿæ´»ä¾‹å­ï¼š</b>æ¯å¤©æ‰“é–‹ IG / FB å°±åƒæ‹¿è‘—ä¸€é¢é¡å­ï¼Œä½†é€™é¢é¡å­åŠ äº†æ¿¾é¡èˆ‡æ¼”ç®—æ³•ï¼Œæœƒæ”¾å¤§æŒ‰è®šèˆ‡è©•è«–ï¼Œä¹…äº†æ ¸å¿ƒè‡ªæˆ‘æœƒè¢«æ‰­æ›²æˆ–è®Šæ¨¡ç³Šã€‚</div>
          </div>
        </details>
        <details class="theory-card border rounded-xl p-4 bg-white">
          <summary class="cursor-pointer flex items-center gap-2 select-none"><span class="text-2xl">ğŸ¯</span><span class="font-semibold">è‡ªæˆ‘æ±ºå®šç†è«–ï¼ˆDeci & Ryanï¼‰</span></summary>
          <div class="mt-3 text-gray-700 space-y-2">
            <div><b>æ ¸å¿ƒæ¦‚å¿µï¼š</b>ç©©å›ºçš„è‡ªæˆ‘å»ºç«‹åœ¨ä¸‰ç¨®åŸºæœ¬å¿ƒç†éœ€æ±‚è¢«æ»¿è¶³ï¼š<u>è‡ªä¸»æ€§</u>ï¼ˆç”±è‡ªå·±é¸æ“‡ï¼‰ã€<u>å‹ä»»æ„Ÿ</u>ï¼ˆæœ‰èƒ½åŠ›æ„Ÿï¼‰ã€<u>é—œä¿‚é€£çµ</u>ï¼ˆè¢«çœŸèª æ¥ç´ï¼‰ã€‚å¤–åœ¨è©•åƒ¹éåº¦æ™‚ï¼Œé€™ä¸‰è€…æ˜“å—ä¾µè•ã€‚</div>
            <div class="p-3 bg-emerald-50 rounded-lg"><b>ç”Ÿæ´»ä¾‹å­ï¼š</b>åªç‚ºå–æ‚…åˆ¥äººçš„å‰µä½œæœƒè€—ç«­ï¼ˆå¤±å»è‡ªä¸»ï¼‰ï¼›ä½†è‹¥å‡ºæ–¼ç†±æ„›è€ŒæŒçºŒï¼Œå³ä½¿è§€çœ¾ä¸å¤šä¹Ÿèƒ½æ„Ÿåˆ°æ»¿è¶³ï¼ˆå…§åœ¨å‹•æ©Ÿï¼‰ã€‚</div>
          </div>
        </details>
        <details class="theory-card border rounded-xl p-4 bg-white">
          <summary class="cursor-pointer flex items-center gap-2 select-none"><span class="text-2xl">ğŸ§©</span><span class="font-semibold">è‡ªæˆ‘æ¦‚å¿µæ¸…æ™°åº¦ï¼ˆCampbell ç­‰ï¼‰</span></summary>
          <div class="mt-3 text-gray-700 space-y-2">
            <div><b>æ ¸å¿ƒæ¦‚å¿µï¼š</b>æŒ‡å€‹äººå°è‡ªå·±ç‰¹è³ªèˆ‡åƒ¹å€¼çš„èªè­˜æ˜¯å¦æ¸…æ¥šã€ç©©å®šä¸”ä¸€è‡´ã€‚æ¸…æ™°åº¦é«˜è€…åœ¨é¢å°å¤–ç•Œè©•åƒ¹æ™‚è¼ƒä¸æ˜“å‹•æ–ï¼Œå°å¿ƒç†å¥åº·æœ‰ä¿è­·ä½œç”¨ã€‚</div>
            <div class="p-3 bg-amber-50 rounded-lg"><b>ç”Ÿæ´»ä¾‹å­ï¼š</b>ç•¶ä½ ç¯¤å®šã€Œèª å¯¦æ¯”è¨å¥½æ›´é‡è¦ã€ï¼Œé¢å°ã€Œä¸å¤ åœ“æ»‘ã€çš„æ‰¹è©•ä¹Ÿä¸æœƒå¦å®šè‡ªå·±ï¼›åä¹‹ï¼Œè‹¥ä¸æ¸…æ¥šè‡ªå·±é‡è¦–ä»€éº¼ï¼Œå°±å®¹æ˜“è¢«æ¯ä¸€æ¬¡è©•åƒ¹ç‰½å‹•ã€‚</div>
          </div>
        </details>
      </div>
    </div>

    <div class="space-y-4">
      <h3 class="text-xl font-semibold">ğŸ›ï¸ ä¸‰å±¤èªåŒå°é½Šå¡ï¼ˆåŠ å¼·ç‰ˆï¼‰</h3>
      <div class="grid md:grid-cols-2 gap-6">
        <div class="space-y-3">
          <div class="p-4 rounded-xl bg-gray-50">
            <div class="font-semibold mb-2">Coreï½œå€‹äººåƒ¹å€¼æ¸…å–®</div>
            <div id="valuesList" class="space-y-2"></div>
            <div class="flex gap-2 mt-2">
              <input id="newValue" class="flex-1 rounded-lg border px-3 py-2" placeholder="è¼¸å…¥åƒ¹å€¼è©ï¼Œå¦‚ï¼šèª å¯¦ã€é—œæ‡·ã€å¥½å¥‡â€¦" />
              <button id="addValue" class="row-btn">æ–°å¢</button>
            </div>
            <div class="text-sm text-gray-600 mt-2">æç¤ºï¼šç”¨ã€Œå‹•ä½œè©ã€æè¿°åƒ¹å€¼ï¼ˆä¾‹ï¼šå‚¾è½ã€æŸ¥è­‰ã€å›æ‡‰ï¼‰ã€‚</div>
          </div>
          <div class="p-4 rounded-xl bg-gray-50">
            <div class="font-semibold mb-2">æœ¬é€±æ ¸å¿ƒåƒ¹å€¼ï¼ˆæ“‡ä¸€ï¼‰</div>
            <div id="weeklyCoreGroup" class="space-y-2"></div>
          </div>
          <div>
            <label class="text-sm text-gray-600">Imageï½œå½¢è±¡èªåŒï¼ˆå¸Œæœ›è¢«çœ‹è¦‹çš„æ¨£å­ï¼‰</label>
            <input id="idImage" class="w-full rounded-lg border px-3 py-2" placeholder="ä¾‹ï¼šå¯é ã€æº«æš–ã€å°ˆæ¥­â€¦" />
          </div>
        </div>

        <div class="space-y-3">
          <div class="p-4 rounded-xl bg-gray-50">
            <div class="font-semibold mb-2">Roleï½œç¤¾æœƒè§’è‰²èˆ‡è¡Œç‚ºè¦å‰‡</div>
            <div id="rolesList" class="space-y-3"></div>
            <div class="flex gap-2 mt-2">
              <input id="newRole" class="flex-1 rounded-lg border px-3 py-2" placeholder="è¼¸å…¥è§’è‰²ï¼Œå¦‚ï¼šè€å¸«ã€æœ‹å‹ã€å®¶äººâ€¦" />
              <button id="addRole" class="row-btn">æ–°å¢è§’è‰²</button>
            </div>
            <div class="text-sm text-gray-600 mt-2">è¦å‰‡æ¨¡æ¿ï¼šç•¶æˆ‘åœ¨ã€è§’è‰²ã€‘é¢å°ã€æƒ…å¢ƒã€‘æ™‚ï¼Œæˆ‘ä»¥ã€æ ¸å¿ƒåƒ¹å€¼ã€‘ç‚ºæº–ï¼Œé¸æ“‡ã€å…·é«”è¡Œç‚ºã€‘ã€‚</div>
          </div>
          <div class="flex items-center gap-2">
            <button id="saveIdentity" class="btn-primary rounded-lg px-3 py-2">å„²å­˜å°é½Šå¡</button>
            <button id="openGuide2" class="row-btn">ğŸ§­ å¼•å°æ¨¡å¼</button>
            <span id="idSavedHint" class="text-sm text-gray-500"></span>
          </div>
          <div id="idPreview" class="mt-1 p-4 bg-white rounded-xl border text-gray-700 hidden"></div>
        </div>
      </div>

      <div class="grid md:grid-cols-2 gap-6">
        <div class="space-y-2">
          <h4 class="font-semibold">ğŸª æ¿¾é¡å·®è·è‡ªæŸ¥</h4>
          <div class="grid grid-cols-2 gap-3">
            <div><label class="text-sm text-gray-600">æˆ‘åœ¨ç¤¾ç¾¤ä¸Šçš„æ¨£å­</label><textarea id="onlineSelf" class="w-full rounded-lg border px-3 py-2" rows="4"></textarea></div>
            <div><label class="text-sm text-gray-600">æˆ‘åœ¨ç¾å¯¦ç”Ÿæ´»çš„æ¨£å­</label><textarea id="offlineSelf" class="w-full rounded-lg border px-3 py-2" rows="4"></textarea></div>
          </div>
          <div class="mt-1"><button id="saveMirror" class="btn-ghost rounded-lg px-3 py-2">å„²å­˜</button><span id="mirrorSavedHint" class="text-sm text-gray-500"></span></div>
          <div id="gapPreview" class="mt-3 p-4 bg-gray-50 rounded-xl text-gray-700 hidden"></div>
        </div>
        <div class="p-4 rounded-xl bg-amber-50 text-gray-700">
          <b>å¸¶é ˜æé†’ï¼š</b>Image/Role çš„è¡¨ç¾ï¼Œç›¡é‡ç”± Core åƒ¹å€¼é•·å‡ºå»ï¼›è‹¥æœ‰è¡çªï¼Œç”¨ã€Œæœ€å°å¦¥å”ï¼‹æƒ…å¢ƒå„ªå…ˆåºã€å¾®èª¿ä¸‹ä¸€æ­¥è¡Œç‚ºã€‚
        </div>
      </div>
    </div>
  </div>
</template>

<script>
(function(){
  function $(s){ return document.querySelector(s); }
  function $all(s){ return document.querySelectorAll(s); }
  function showJsOk(){ var el=$('#jsOk'); if(el) el.style.display='block'; }
  showJsOk();

  // NAV ACTIVE
  var navLinks=$all('.nav-link'); var sections=$all('main section');
  window.addEventListener('scroll', function(){
    var current='';
    sections.forEach(function(section){ if(pageYOffset >= section.offsetTop - 80) current = section.getAttribute('id'); });
    navLinks.forEach(function(link){ link.classList.remove('active'); if(link.getAttribute('href').substring(1)===current) link.classList.add('active'); });
  });

  // Simple tokenizer + Jaccard
  function tokenize(s){ var m=String(s||'').toLowerCase().match(/[\u4e00-\u9fa5\w]+/g); return m?m:[]; }
  function jaccard(a,b){
    var A=Array.from(new Set(tokenize(a))); var B=Array.from(new Set(tokenize(b)));
    var inter=A.filter(function(x){return B.indexOf(x)>-1}).length; var uni=Array.from(new Set(A.concat(B))).length||1; return inter/uni;
  }

  // Storage
  var store={
    get tags(){ try{return JSON.parse(localStorage.getItem('tags')||'[]')}catch(e){return []} },
    set tags(v){ localStorage.setItem('tags', JSON.stringify(v)) },
    get flips(){ try{return JSON.parse(localStorage.getItem('flips')||'[]')}catch(e){return []} },
    set flips(v){ localStorage.setItem('flips', JSON.stringify(v)) },
    get identity(){ try{return JSON.parse(localStorage.getItem('identity')||'{}')}catch(e){return {}} },
    set identity(v){ localStorage.setItem('identity', JSON.stringify(v)) },
    get mirror(){ try{return JSON.parse(localStorage.getItem('mirror')||'{}')}catch(e){return {}} },
    set mirror(v){ localStorage.setItem('mirror', JSON.stringify(v)) }
  };

  // Fallback charts (no external libs)
  function drawBarChart(canvas, labels, values){
    if(!canvas || !canvas.getContext) return;
    var ctx=canvas.getContext('2d');
    // HiDPI
    var ratio=window.devicePixelRatio||1;
    var rect=canvas.getBoundingClientRect();
    canvas.width=rect.width*ratio; canvas.height=rect.height*ratio; ctx.setTransform(ratio,0,0,ratio,0,0);

    var W=rect.width, H=rect.height, pad=40, barH=36, gap=28;
    ctx.clearRect(0,0,W,H);
    ctx.font='14px sans-serif'; ctx.fillStyle='#111';
    var max=100;
    for(var i=0;i<labels.length;i++){
      var y=pad + i*(barH+gap);
      // label
      ctx.fillStyle='#444'; ctx.fillText(labels[i], 10, y+barH*0.7);
      // bar bg
      ctx.fillStyle='#e5e7eb'; ctx.fillRect(220, y, W-260, barH);
      // bar value
      var w=(W-260)*Math.max(0,Math.min(1,values[i]/max));
      ctx.fillStyle= i===0 ? 'rgba(52, 152, 219, 0.9)' : 'rgba(211, 84, 0, 0.9)';
      ctx.fillRect(220, y, w, barH);
      // value text
      ctx.fillStyle='#111'; ctx.fillText(values[i], 225+w-20, y+barH*0.7);
    }
    // axis title
    ctx.fillStyle='#666'; ctx.fillText('ç›¸å°å¼·åº¦èˆ‡é »ç‡æŒ‡æ•¸ï¼ˆ0â€“100ï¼‰', 220, H-12);
  }

  function drawRadar3(canvas, labels, values){ // values: 0â€“100
    if(!canvas || !canvas.getContext) return;
    var ctx=canvas.getContext('2d');
    var ratio=window.devicePixelRatio||1;
    var rect=canvas.getBoundingClientRect();
    canvas.width=rect.width*ratio; canvas.height=rect.height*ratio; ctx.setTransform(ratio,0,0,ratio,0,0);

    var W=rect.width, H=rect.height;
    var cx=W/2, cy=H/2+10, R=Math.min(W,H)*0.33;
    ctx.clearRect(0,0,W,H);
    ctx.font='13px sans-serif';

    // axes (triangle)
    var angles=[-Math.PI/2, -Math.PI/2+2*Math.PI/3, -Math.PI/2+4*Math.PI/3];
    ctx.strokeStyle='#e5e7eb';
    for(var k=1;k<=5;k++){
      ctx.beginPath();
      for(var i=0;i<3;i++){
        var r=R*(k/5);
        var x=cx + r*Math.cos(angles[i]);
        var y=cy + r*Math.sin(angles[i]);
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.closePath(); ctx.stroke();
    }
    // axis lines
    ctx.strokeStyle='#cbd5e1';
    for(var j=0;j<3;j++){
      ctx.beginPath(); ctx.moveTo(cx,cy);
      ctx.lineTo(cx + R*Math.cos(angles[j]), cy + R*Math.sin(angles[j]));
      ctx.stroke();
    }
    // labels
    var labelOff=18; ctx.fillStyle='#111';
    for(var m=0;m<3;m++){
      var lx=cx + (R+labelOff)*Math.cos(angles[m]);
      var ly=cy + (R+labelOff)*Math.sin(angles[m]);
      ctx.textAlign = Math.cos(angles[m])>0.1 ? 'left' : (Math.cos(angles[m])<-0.1 ? 'right' : 'center');
      ctx.textBaseline = Math.sin(angles[m])>0.1 ? 'top' : (Math.sin(angles[m])<-0.1 ? 'bottom' : 'middle');
      ctx.fillText(labels[m], lx, ly);
    }
    // data polygon
    ctx.beginPath();
    for(var t=0;t<3;t++){
      var rr=R*(Math.max(0,Math.min(100,values[t]))/100);
      var px=cx + rr*Math.cos(angles[t]);
      var py=cy + rr*Math.sin(angles[t]);
      if(t===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
    }
    ctx.closePath();
    ctx.fillStyle='rgba(211,84,0,0.25)'; ctx.fill();
    ctx.strokeStyle='rgba(211,84,0,1)'; ctx.stroke();
  }

  // Social Pressure chart init
   window.addEventListener('DOMContentLoaded', () => {
      const c = document.getElementById('socialPressureChart');
      if (c && c.getContext) {
        const g = c.getContext('2d');
        new Chart(g, {
          type: 'bar',
          data: {
            labels: ['ç¾å¯¦ç”Ÿæ´»ä¸­çš„è©•åƒ¹æ™‚åˆ»', 'ç¤¾ç¾¤åª’é«”ä¸Šçš„è©•åƒ¹æ™‚åˆ»'],
            datasets: [{
              label: 'æ¯æ—¥å¯èƒ½é¢è‡¨çš„è©•åƒ¹å¼·åº¦èˆ‡é »ç‡',
              data: [25, 85],
              backgroundColor: ['rgba(52, 152, 219, 0.6)','rgba(211, 84, 0, 0.6)'],
              borderColor: ['rgba(52, 152, 219, 1)','rgba(211, 84, 0, 1)'],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true, maintainAspectRatio: false, indexAxis: 'y',
            scales: { x: { beginAtZero: true, max: 100, title: { display: true, text: 'ç›¸å°å¼·åº¦èˆ‡é »ç‡æŒ‡æ•¸' } } },
            plugins: { legend: { display: false } }
          }
        });
      }
  });

  // Tag wall
  function bindTagWall(){
    var tagInput=$('#tagInput'), tagTone=$('#tagTone'), addTagBtn=$('#addTagBtn'), tagWall=$('#tagWall');
    function escapeHtml(s){ return (s||'').replace(/[&<>"]/g, function(c){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]}); }
    function renderTags(){
      if(!tagWall) return;
      tagWall.innerHTML='';
      store.tags.forEach(function(t,idx){
        var span=document.createElement('span');
        span.className='pill ' + (t.tone==='bad'?'bad':t.tone==='good'?'good':'');
        span.innerHTML=(t.tone==='bad'?'ğŸ˜µ':t.tone==='good'?'ğŸŒŸ':'ğŸ˜¶')+' '+ escapeHtml(t.text) + ' <button title="ç§»é™¤" class="text-gray-500 hover:text-red-600" data-x="'+idx+'">âœ•</button>';
        tagWall.appendChild(span);
      });
      Array.from(tagWall.querySelectorAll('button[data-x]')).forEach(function(btn){
        btn.addEventListener('click', function(e){
          var i=+e.currentTarget.getAttribute('data-x'); var arr=store.tags; arr.splice(i,1); store.tags=arr; renderTags();
        });
      });
    }
    if(addTagBtn){
      addTagBtn.addEventListener('click', function(){
        var text=(tagInput.value||'').trim(); if(!text) return;
        var arr=store.tags; arr.push({text:text, tone:tagTone.value}); store.tags=arr; tagInput.value=''; renderTags();
      });
      renderTags();
    }
  }

  // Tabs
  var tabContent=$('#tabContent'); var tabs=$all('.tab');
  var T={ tab1:$('#tab1-tpl').innerHTML, tab2:$('#tab2-tpl').innerHTML, tab3:$('#tab3-tpl').innerHTML };
  function activateTab(id){
    tabs.forEach(function(b){ b.classList.toggle('active', b.getAttribute('data-tab')===id); });
    tabContent.innerHTML=T[id];
    if(id==='tab1'){ bindTimer(); bindDoodle(); }
    if(id==='tab2'){ bindFlip(); }
    if(id==='tab3'){ bindIdentityCard(); }
    bindGuideButtons(); // ç¢ºä¿ä»»ä½•åˆ†é é–‹å•Ÿå¼•å°æ¨¡å¼éƒ½å¯ç”¨
  }
  tabs.forEach(function(b){ b.addEventListener('click', function(){ activateTab(b.getAttribute('data-tab')); }); });

  // Timer
  function bindTimer(){
    var timerDisplay=$('#timerDisplay'), timerControls=$('#timerControls'), timerResult=$('#timerResult');
    var timerInterval, startTime;
    function formatTime(ms){ var s=Math.floor((ms/1000)%60), m=Math.floor((ms/(1000*60))%60); return String(m).padStart(2,'0')+':'+String(s).padStart(2,'0'); }
    function startTimer(){
      startTime=Date.now(); timerResult.textContent='';
      timerControls.innerHTML='<button id="stopTimerBtn" class="btn-secondary font-bold py-3 px-8 rounded-full text-lg">æˆ‘è¦ºå¾—ä¸€åˆ†é˜åˆ°äº†</button>';
      $('#stopTimerBtn').addEventListener('click', stopTimer);
      timerInterval=setInterval(function(){ var elapsed=Date.now()-startTime; timerDisplay.textContent=formatTime(elapsed); },100);
    }
    function stopTimer(){
      clearInterval(timerInterval);
      var duration=Date.now()-startTime; var diff=Math.abs(duration-60000);
      var text='ä½ èªç‚ºçš„ä¸€åˆ†é˜æ˜¯ '+ (Math.round(duration/100)/10).toFixed(1) +' ç§’ã€‚';
      if(diff<=5000) text+=' éå¸¸æ¥è¿‘ï¼ä½ çš„å…§åœ¨æ™‚é˜å¾ˆæº–ç¢ºã€‚';
      else if(diff<=15000) text+=' é‚„ä¸éŒ¯ï¼å¤šç·´ç¿’å¯ä»¥æ›´ç²¾æº–ã€‚';
      else text+=' å·®è·æœ‰é»å¤§ï¼Œé€™èªªæ˜æˆ‘å€‘çš„æ€ç·’å¾ˆå®¹æ˜“å½±éŸ¿æ™‚é–“æ„Ÿã€‚é€™æ­£æ˜¯ç·´ç¿’å°ˆæ³¨çš„åƒ¹å€¼æ‰€åœ¨ï¼';
      timerResult.innerHTML=text;
      timerControls.innerHTML='<button id="startTimerBtnNew" class="btn-primary font-bold py-3 px-8 rounded-full text-lg">å†è©¦ä¸€æ¬¡</button>';
      $('#startTimerBtnNew').addEventListener('click', startTimer);
    }
    var startBtn=$('#startTimerBtn'); if(startBtn) startBtn.addEventListener('click', startTimer);
  }

  // Doodle
  function bindDoodle(){
    var canvas=$('#doodleCanvas'), startBtn=$('#startDoodle'), clearBtn=$('#clearDoodle');
    if(!canvas) return;
    var ctx=canvas.getContext('2d'); var drawing=false, started=false;
    function resizeDPR(){
      var ratio=window.devicePixelRatio||1; var rect=canvas.getBoundingClientRect();
      canvas.width=rect.width*ratio; canvas.height=rect.height*ratio; ctx.setTransform(ratio,0,0,ratio,0,0);
    }
    resizeDPR(); window.addEventListener('resize', resizeDPR);
    function pos(e){ var r=canvas.getBoundingClientRect(); var x=(e.touches?e.touches[0].clientX:e.clientX)-r.left; var y=(e.touches?e.touches[0].clientY:e.clientY)-r.top; return {x:x,y:y}; }
    function dot(x,y){ ctx.fillStyle='#111827'; ctx.beginPath(); ctx.arc(x,y,1.2,0,Math.PI*2); ctx.fill(); }
    function move(e){ if(!drawing) return; var p=pos(e); dot(p.x,p.y); }
    function down(e){ drawing=started; move(e); }
    function up(){ drawing=false; }
    if(startBtn) startBtn.addEventListener('click', function(){ started=true; startBtn.disabled=true; startBtn.textContent='å·²é–‹å§‹'; });
    if(clearBtn) clearBtn.addEventListener('click', function(){ ctx.clearRect(0,0,canvas.width,canvas.height); });
    canvas.addEventListener('mousedown', down); canvas.addEventListener('mousemove', move); window.addEventListener('mouseup', up);
    canvas.addEventListener('touchstart', down, {passive:false});
    canvas.addEventListener('touchmove', function(e){ e.preventDefault(); move(e); }, {passive:false});
    canvas.addEventListener('touchend', up);
  }

  // FLIP
  var FLIPCARD_POOL=[
    {title:'Fï½œFind Facts', steps:['æŠŠäº‹ä»¶æ”¹å¯«æˆç´”äº‹å¯¦å¥ã€‚','ç§»é™¤å‹•æ©Ÿèˆ‡æ€§æ ¼æ¨è«–ã€‚','ç¢ºèªï¼šæœ‰æ²’æœ‰è­‰æ“šï¼Ÿ']},
    {title:'Lï½œLocate Levers', steps:['æˆ‘èƒ½å½±éŸ¿å“ªä¸€å°éƒ¨åˆ†ï¼Ÿ','æŠŠç¯„åœç¸®å°åˆ°å¯è¡Œçš„ä¸€æ­¥ã€‚','å®šç¾©ä»Šå¤©èƒ½åšçš„ 10 åˆ†é˜è¡Œå‹•ã€‚']},
    {title:'Iï½œInventory Values', steps:['é€™ä»¶äº‹è¸©åˆ°äº†æˆ‘å“ªäº›åƒ¹å€¼ï¼Ÿ','æ›å€‹åƒ¹å€¼è¦–è§’æœƒæ€éº¼çœ‹ï¼Ÿ','å¯«ä¸€å¥å°é½Šåƒ¹å€¼çš„å›æ‡‰ã€‚']},
    {title:'Pï½œPlan the Next', steps:['å¦‚æœé‡ä¾†ä¸€æ¬¡ï¼Œæˆ‘çš„ B è¨ˆç•«ï¼Ÿ','èª°èƒ½å”åŠ©æˆ‘ï¼Ÿ','é ç´„ä¸‹ä¸€æ¬¡æª¢è¦–æ™‚é–“ã€‚']},
  ];
  function bindFlip(){
    var pickBtn=$('#pickBadTag'), pickedTag=$('#pickedTag'), flipInput=$('#flipRewrite'), saveFlip=$('#saveFlip'), hint=$('#flipSavedHint'), drawBtn=$('#drawFlipCard'), flipCard=$('#flipCard'), flipGuide=$('#flipCardGuide'), flipList=$('#flipList'), cancelEdit=$('#cancelEdit');
    var editingIndex=null;
    function escapeHtml(s){ return (s||'').replace(/[&<>"]/g, function(c){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]}); }
    function renderList(){
      var arr=store.flips.slice().sort(function(a,b){return b.time-a.time;});
      if(arr.length===0){ flipList.innerHTML='<li class="text-gray-500">ï¼ˆç›®å‰æ²’æœ‰ç´€éŒ„ï¼‰</li>'; return; }
      flipList.innerHTML=arr.map(function(f){
        var globalIndex=store.flips.findIndex(function(x){return x.time===f.time && x.tag===f.tag && x.text===f.text;});
        return '<li class="p-3 border rounded-lg flex flex-col md:flex-row md:items-center md:justify-between gap-2">\
          <div>'+ new Date(f.time).toLocaleString() +'ï½œ<b>'+ escapeHtml(f.tag) +'</b> â†’ '+ escapeHtml(f.text) +'</div>\
          <div class="flex gap-2 shrink-0">\
            <button class="btn-ghost rounded px-3 py-1" data-edit="'+globalIndex+'">ç·¨è¼¯</button>\
            <button class="btn-danger rounded px-3 py-1" data-del="'+globalIndex+'">åˆªé™¤</button>\
          </div>\
        </li>';
      }).join('');
      Array.from(flipList.querySelectorAll('button[data-del]')).forEach(function(btn){
        btn.addEventListener('click', function(e){
          var idx=+e.currentTarget.getAttribute('data-del'); var arr2=store.flips; arr2.splice(idx,1); store.flips=arr2; if(editingIndex===idx){ resetEditUI(); } renderList();
        });
      });
      Array.from(flipList.querySelectorAll('button[data-edit]')).forEach(function(btn){
        btn.addEventListener('click', function(e){
          var idx=+e.currentTarget.getAttribute('data-edit'); var rec=store.flips[idx];
          pickedTag.textContent='ğŸ˜µ '+rec.tag; pickedTag.setAttribute('data-value', rec.tag);
          flipInput.value=rec.text; editingIndex=idx; saveFlip.textContent='æ›´æ–°åè½‰'; cancelEdit.classList.remove('hidden'); hint.textContent='ï¼ˆç·¨è¼¯æ¨¡å¼ï¼‰';
        });
      });
    }
    function resetEditUI(){ editingIndex=null; saveFlip.textContent='å„²å­˜åè½‰'; cancelEdit.classList.add('hidden'); hint.textContent=''; flipInput.value=''; }
    renderList();
    if(cancelEdit) cancelEdit.addEventListener('click', resetEditUI);
    if(pickBtn) pickBtn.addEventListener('click', function(){
      var bads=store.tags.filter(function(t){return t.tone==='bad';}); if(bads.length===0){ pickedTag.textContent='ï¼ˆæ¨™ç±¤ç‰†å°šæœªæ–°å¢è² å‘æ¨™ç±¤ï¼‰'; return; }
      var r=bads[Math.floor(Math.random()*bads.length)]; pickedTag.textContent='ğŸ˜µ '+r.text; pickedTag.setAttribute('data-value', r.text);
    });
    if(saveFlip) saveFlip.addEventListener('click', function(){
      var tag=pickedTag.getAttribute('data-value'); var text=(flipInput.value||'').trim();
      if(!tag||!text){ hint.textContent='è«‹å…ˆæŠ½æ¨™ç±¤ä¸¦å¡«å…¥åè½‰æ•˜äº‹'; return; }
      var arr=store.flips||[];
      if(editingIndex!==null){ arr[editingIndex]={tag:tag,text:text,time:arr[editingIndex].time}; hint.textContent='å·²æ›´æ–°'; }
      else { arr.push({tag:tag,text:text,time:Date.now()}); hint.textContent='å·²å„²å­˜'; }
      store.flips=arr; setTimeout(function(){ hint.textContent=''; },1500); renderList(); resetEditUI();
    });
    if(drawBtn) drawBtn.addEventListener('click', function(){
      var card=FLIPCARD_POOL[Math.floor(Math.random()*FLIPCARD_POOL.length)];
      flipCard.textContent='ğŸƒ '+card.title;
      flipGuide.innerHTML=card.steps.map(function(s){return '<li>'+s+'</li>';}).join('');
    });
  }

  // Identity + Guide
  function bindIdentityCard(){
    var valuesList=$('#valuesList'), newValue=$('#newValue'), addValue=$('#addValue'), coreGroup=$('#weeklyCoreGroup');
    var rolesList=$('#rolesList'), newRole=$('#newRole'), addRole=$('#addRole');
    var idImage=$('#idImage'), saveBtn=$('#saveIdentity'), hint=$('#idSavedHint'), preview=$('#idPreview');
    var onlineSelf=$('#onlineSelf'), offlineSelf=$('#offlineSelf'), saveMirror=$('#saveMirror'), mirrorSaved=$('#mirrorSavedHint'), gapPreview=$('#gapPreview');

    var idOld=store.identity||{};
    var state={
      values:Array.isArray(idOld.values)? idOld.values : (idOld.personal? idOld.personal.split(/[ã€,ï¼Œ\s]+/).filter(Boolean): []),
      weeklyCore:idOld.weeklyCore||'',
      roles:Array.isArray(idOld.roles)? idOld.roles : (idOld.social? idOld.social.split(/[ã€,ï¼Œ\s]+/).filter(Boolean).map(function(r){return {role:r, rule:''};}) : []),
      image:idOld.image||''
    };

    function escapeHtml(s){ return (s||'').replace(/[&<>"]/g, function(c){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]}); }

    function renderValues(){
      valuesList.innerHTML='';
      (state.values||[]).forEach(function(v,i){
        var row=document.createElement('div'); row.className='flex items-center gap-2';
        row.innerHTML='<input class="rounded-lg border px-3 py-2 flex-1" value="'+escapeHtml(v)+'" data-vi="'+i+'" />\
                       <button class="row-btn" data-up="'+i+'" title="ä¸Šç§»">â†‘</button>\
                       <button class="row-btn" data-down="'+i+'" title="ä¸‹ç§»">â†“</button>\
                       <button class="row-btn" data-del="'+i+'" title="åˆªé™¤">âœ•</button>';
        valuesList.appendChild(row);
      });
      Array.from(valuesList.querySelectorAll('input[data-vi]')).forEach(function(inp){
        inp.addEventListener('input', function(e){ var i=+e.currentTarget.getAttribute('data-vi'); state.values[i]=e.currentTarget.value.trim(); renderCoreGroup(); });
      });
      Array.from(valuesList.querySelectorAll('button[data-del]')).forEach(function(btn){
        btn.addEventListener('click', function(e){ var i=+e.currentTarget.getAttribute('data-del'); state.values.splice(i,1); if(state.weeklyCore && state.values.indexOf(state.weeklyCore)===-1) state.weeklyCore=''; renderValues(); renderCoreGroup(); });
      });
      Array.from(valuesList.querySelectorAll('button[data-up]')).forEach(function(btn){
        btn.addEventListener('click', function(e){ var i=+e.currentTarget.getAttribute('data-up'); if(i<=0) return; var t=state.values[i-1]; state.values[i-1]=state.values[i]; state.values[i]=t; renderValues(); renderCoreGroup(); });
      });
      Array.from(valuesList.querySelectorAll('button[data-down]')).forEach(function(btn){
        btn.addEventListener('click', function(e){ var i=+e.currentTarget.getAttribute('data-down'); if(i>=state.values.length-1) return; var t=state.values[i+1]; state.values[i+1]=state.values[i]; state.values[i]=t; renderValues(); renderCoreGroup(); });
      });
    }
    function renderCoreGroup(){
      coreGroup.innerHTML='';
      (state.values||[]).forEach(function(v){
        if(!v) return;
        var id='core_'+btoa(unescape(encodeURIComponent(v))).replace(/=/g,'');
        var row=document.createElement('div'); row.className='flex items-center gap-2';
        row.innerHTML='<input type="radio" name="weeklyCore" id="'+id+'" '+(state.weeklyCore===v?'checked':'')+' />\
                       <label for="'+id+'" class="flex-1">'+escapeHtml(v)+'</label>';
        coreGroup.appendChild(row);
      });
      Array.from(coreGroup.querySelectorAll('input[name="weeklyCore"]')).forEach(function(r){
        r.addEventListener('change', function(e){ var label=e.currentTarget.nextElementSibling; state.weeklyCore=label.textContent.trim(); });
      });
    }
    function renderRoles(){
      rolesList.innerHTML='';
      (state.roles||[]).forEach(function(r,i){
        var row=document.createElement('div'); row.className='border rounded-lg p-3 bg-white';
        row.innerHTML='<div class="flex gap-2 mb-2">\
                         <input class="rounded-lg border px-3 py-2 flex-1" placeholder="è§’è‰²åç¨±" value="'+escapeHtml(r.role||'')+'" data-ri="'+i+'" data-field="role" />\
                         <button class="row-btn" data-rdel="'+i+'" title="åˆªé™¤è§’è‰²">âœ•</button>\
                       </div>\
                       <input class="rounded-lg border px-3 py-2 w-full" placeholder="è¡Œç‚ºè¦å‰‡ï¼šç•¶æˆ‘åœ¨ã€è§’è‰²ã€‘é¢å°ã€æƒ…å¢ƒã€‘æ™‚ï¼Œæˆ‘ä»¥ã€æ ¸å¿ƒåƒ¹å€¼ã€‘ç‚ºæº–ï¼Œé¸æ“‡ã€å…·é«”è¡Œç‚ºã€‘ã€‚" value="'+escapeHtml(r.rule||'')+'" data-ri="'+i+'" data-field="rule" />\
                       <div class="mt-2"><button class="row-btn" data-autofill="'+i+'">ç”¨æ ¸å¿ƒåƒ¹å€¼è‡ªå‹•å¥—ç‰ˆ</button></div>';
        rolesList.appendChild(row);
      });
      Array.from(rolesList.querySelectorAll('input[data-field]')).forEach(function(inp){
        inp.addEventListener('input', function(e){ var i=+e.currentTarget.getAttribute('data-ri'); var f=e.currentTarget.getAttribute('data-field'); state.roles[i][f]=e.currentTarget.value; });
      });
      Array.from(rolesList.querySelectorAll('button[data-rdel]')).forEach(function(btn){
        btn.addEventListener('click', function(e){ var i=+e.currentTarget.getAttribute('data-rdel'); state.roles.splice(i,1); renderRoles(); });
      });
      Array.from(rolesList.querySelectorAll('button[data-autofill]')).forEach(function(btn){
        btn.addEventListener('click', function(e){
          var i=+e.currentTarget.getAttribute('data-autofill'); var role=state.roles[i]&&state.roles[i].role? state.roles[i].role : 'ï¼ˆè§’è‰²ï¼‰'; var core=state.weeklyCore||'ï¼ˆæ ¸å¿ƒåƒ¹å€¼ï¼‰';
          var tmpl='ç•¶æˆ‘åœ¨ã€Œ'+role+'ã€è§’è‰²é¢å°ã€å…·é«”æƒ…å¢ƒã€‘æ™‚ï¼Œæˆ‘ä»¥ã€Œ'+core+'ã€ç‚ºæº–ï¼Œé¸æ“‡ã€å…·é«”è¡Œç‚ºã€‘ã€‚';
          var box=rolesList.querySelector('input[data-ri="'+i+'"][data-field="rule"]'); if(box){ box.value=tmpl; state.roles[i].rule=tmpl; }
        });
      });
    }
    if(addValue) addValue.addEventListener('click', function(){ var v=(newValue.value||'').trim(); if(!v) return; state.values.push(v); newValue.value=''; renderValues(); renderCoreGroup(); });
    if(addRole) addRole.addEventListener('click', function(){ var r=(newRole.value||'').trim(); if(!r) return; state.roles.push({role:r, rule:''}); newRole.value=''; renderRoles(); });

    idImage.value=state.image||'';
    renderValues(); renderCoreGroup(); renderRoles();

    var m=store.mirror||{}; if(onlineSelf) onlineSelf.value=m.online||''; if(offlineSelf) offlineSelf.value=m.offline||'';
    if(m.online||m.offline){ gapPreview.classList.remove('hidden'); gapPreview.innerHTML=renderGap(m); }
    function renderGap(v){ var gap=1-jaccard(v.online||'',v.offline||''); var score=(gap*100).toFixed(0); var desc=gap<0.34?'å·®è·åå¤§ï¼šç•™æ„æ˜¯å¦è¿åˆè©•åƒ¹':'å·®è·é©ä¸­æˆ–å°ï¼šç·šä¸Šç·šä¸‹è¼ƒä¸€è‡´'; return '<div><div class="font-semibold mb-1">å·®è·è§€å¯Ÿ</div><p class="text-gray-700"><b>ä¼°è¨ˆä¸€è‡´åº¦ï¼š</b>'+score+' / 100</p><p class="text-gray-700 mt-1">'+desc+'</p></div>'; }
    if(saveMirror) saveMirror.addEventListener('click', function(){ var v={online:onlineSelf.value.trim(), offline:offlineSelf.value.trim()}; store.mirror=v; if(mirrorSaved) mirrorSaved.textContent='å·²å„²å­˜'; if(gapPreview){ gapPreview.classList.remove('hidden'); gapPreview.innerHTML=renderGap(v); } setTimeout(function(){ if(mirrorSaved) mirrorSaved.textContent=''; },1500); });

    if(saveBtn) saveBtn.addEventListener('click', function(){
      var identity={ values:(state.values||[]).filter(Boolean), weeklyCore:state.weeklyCore||'', roles:(state.roles||[]).filter(function(r){return r.role||r.rule;}), image:idImage.value.trim(), personal:(state.values||[]).join('ã€'), social:(state.roles||[]).map(function(r){return r.role;}).join('ã€') };
      store.identity=identity; if(hint) hint.textContent='å·²å„²å­˜'; if(preview){ preview.classList.remove('hidden'); preview.innerHTML=renderPreview(identity); } setTimeout(function(){ if(hint) hint.textContent=''; },1500);
    });
    function renderPreview(v){
      var vals=(v.values||[]).map(function(x){return '<span class="pill mr-1 mb-1">'+x+'</span>';}).join(' ');
      var roles=(v.roles||[]).map(function(r){return '<li><b>'+ (r.role||'') +'</b>ï¼š'+ (r.rule||'') +'</li>';}).join('') || '<li class="text-gray-500">â€”</li>';
      return '<div class="space-y-2">\
        <div><b>æ ¸å¿ƒåƒ¹å€¼æ¸…å–®ï¼š</b> '+(vals||'â€”')+'</div>\
        <div><b>æœ¬é€±æ ¸å¿ƒåƒ¹å€¼ï¼š</b> '+(v.weeklyCore||'â€”')+'</div>\
        <div><b>å½¢è±¡èªåŒï¼š</b> '+(v.image||'â€”')+'</div>\
        <div><b>è§’è‰²èˆ‡è¦å‰‡ï¼š</b><ul class="list-disc list-inside">'+roles+'</ul></div>\
      </div>';
    }
    var idStored=store.identity||{};
    if((idStored.values&&idStored.values.length)||(idStored.roles&&idStored.roles.length)||idStored.image||idStored.weeklyCore){
      if(preview){ preview.classList.remove('hidden'); preview.innerHTML=renderPreview(idStored); }
      if(Array.isArray(idStored.values)) state.values=idStored.values;
      if(Array.isArray(idStored.roles)) state.roles=idStored.roles;
      if(idStored.weeklyCore) state.weeklyCore=idStored.weeklyCore;
      if(idStored.image) idImage.value=idStored.image;
      renderValues(); renderCoreGroup(); renderRoles();
    }
  }

  // Guide (global bind)
  function bindGuideButtons(){
    var open1=$('#openGuide'), open2=$('#openGuide2'), open3=$('#openGuideFromTab2');
    var modal=$('#guideModal'), closeGuide=$('#closeGuide');
    var steps=[ $('#guideStep1'), $('#guideStep2'), $('#guideStep3'), $('#guideStep4') ];
    var idx=0;
    function showStep(i){
      idx=i; steps.forEach(function(el,k){ if(el) el.classList.toggle('active', k===i); });
      Array.from(document.querySelectorAll('.guide-nav')).forEach(function(btn){
        var target=+btn.getAttribute('data-step')-1; btn.classList.toggle('btn-primary', target===i);
      });
      if(i===3){ renderAlignment(); }
    }
    function renderAlignment(){
      var id=store.identity||{};
      var core=(id.weeklyCore||'')+' '+(id.values? id.values.join(' ') : '');
      var rolesText=(id.roles||[]).map(function(r){ return (r.role||'')+' '+(r.rule||''); }).join(' ');
      var image=id.image||'';
      var sCR=Math.round(jaccard(core, rolesText)*100);
      var sCI=Math.round(jaccard(core, image)*100);
      var sRI=Math.round(jaccard(rolesText, image)*100);
      var c=$('#alignRadar'); if(!c) return;
      drawRadar3(c, ['Coreâ†”Role','Coreâ†”Image','Roleâ†”Image'], [sCR,sCI,sRI]);
      var avg=(sCR+sCI+sRI)/3;
      var msg = avg>=66 ? 'æ•´é«”å°é½Šè‰¯å¥½ï¼Œç¶­æŒè¡Œå‹•è¦å‰‡å³å¯ã€‚' : (avg>=33 ? 'ä¸­åº¦å°é½Šï¼šæŒ‘ 1â€“2 è™•æ–‡å­—å†å¾®èª¿ï¼Œä½¿ä¹‹æ›´å‘¼æ‡‰æ ¸å¿ƒåƒ¹å€¼ã€‚' : 'å°é½Šä¸è¶³ï¼šè«‹å›åˆ° Core æˆ– Role é‡æ–°æ’°å¯«ï¼Œè®“å½¢è±¡ç”±åƒ¹å€¼é•·å‡ºã€‚');
      var at=$('#alignText'); if(at) at.textContent='Coreâ†”Roleï¼š'+sCR+'%ï¼ŒCoreâ†”Imageï¼š'+sCI+'%ï¼ŒRoleâ†”Imageï¼š'+sRI+'%ã€‚'+msg;
    }
    function openGuide(){ if(modal){ modal.style.display='flex'; showStep(0); } }
    [open1,open2,open3].forEach(function(b){ if(b) b.addEventListener('click', openGuide); });
    if(closeGuide) closeGuide.addEventListener('click', function(){ if(modal) modal.style.display='none'; });
    var prevBtn=$('#prevStep'), nextBtn=$('#nextStep');
    if(prevBtn) prevBtn.addEventListener('click', function(){ showStep(Math.max(0, idx-1)); });
    if(nextBtn) nextBtn.addEventListener('click', function(){ showStep(Math.min(3, idx+1)); });
    // å°è¦½åˆ—é»æ“Šï¼ˆäº‹ä»¶å§”æ´¾ï¼‰
    document.addEventListener('click', function(e){
      var t=e.target;
      if(t && t.classList.contains('guide-nav')){
        var n=+t.getAttribute('data-step'); if(n>=1 && n<=4) showStep(n-1);
      }
    });
  }

  // Export
  function bindExport(){
    var exportBtn=$('#exportBtn'), exportHint=$('#exportHint'), modal=$('#exportModal'), exportText=$('#exportText');
    var closeModal=$('#closeModal'), copyBtn=$('#copyBtn');
    function downloadBlob(text, filename, mime){
      var blob=new Blob([text], {type:mime}); var url=URL.createObjectURL(blob);
      var a=document.createElement('a'); a.href=url; a.download=filename; document.body.appendChild(a); a.click(); a.remove();
      setTimeout(function(){ URL.revokeObjectURL(url); }, 1000);
    }
    function buildText(){
      var p={ tags:store.tags, flips:store.flips, identity:store.identity, mirror:store.mirror };
      var valsArr=p.identity && p.identity.values? p.identity.values:[];
      var rolesArr=p.identity && p.identity.roles? p.identity.roles:[];
      var vals=valsArr.map(function(v){return '- '+v;}).join('\n') || '';
      var roles=rolesArr.map(function(r){return '- '+(r.role||'')+'ï½œ'+(r.rule||'');}).join('\n') || '';
      return [
        'ã€æ¨™ç±¤ç‰†ã€‘'
      ].concat((p.tags||[]).map(function(t){return '- ['+t.tone+'] '+t.text;}))
      .concat(['','ã€åè½‰ç´€éŒ„ã€‘'])
      .concat((p.flips||[]).sort(function(a,b){return a.time-b.time;}).map(function(f){return '- '+new Date(f.time).toLocaleString()+'ï½œ'+f.tag+' â†’ '+f.text;}))
      .concat(['','ã€ä¸‰å±¤èªåŒå°é½Šå¡ã€‘','- æ ¸å¿ƒåƒ¹å€¼æ¸…å–®ï¼š\n'+vals,'- æœ¬é€±æ ¸å¿ƒåƒ¹å€¼ï¼š'+(p.identity&&p.identity.weeklyCore?p.identity.weeklyCore:''),'- å½¢è±¡èªåŒï¼š'+(p.identity&&p.identity.image?p.identity.image:''),'- è§’è‰²èˆ‡è¡Œç‚ºè¦å‰‡ï¼š\n'+roles,'','ã€æ¿¾é¡å·®è·ã€‘','- ç·šä¸Šï¼š'+(p.mirror&&p.mirror.online?p.mirror.online:''),'- ç·šä¸‹ï¼š'+(p.mirror&&p.mirror.offline?p.mirror.offline:'')]).join('\n');
    }
    function toMarkdown(){ return buildText(); }
    function toCSV(){
      var p={ tags:store.tags, flips:store.flips, identity:store.identity, mirror:store.mirror };
      function esc(s){ return '"'+ String(s||'').replace(/"/g,'""') + '"'; }
      var rows=[['Section','Field','Value']];
      (p.tags||[]).forEach(function(t){ rows.push(['TagWall','tag', t.tone+':'+t.text]); });
      (p.flips||[]).forEach(function(f){ rows.push(['Flip','record', new Date(f.time).toLocaleString()+'ï½œ'+f.tag+'â†’'+f.text]); });
      var valsArr=p.identity && p.identity.values? p.identity.values:[]; valsArr.forEach(function(v){ rows.push(['Identity','value', v]); });
      rows.push(['Identity','weeklyCore', (p.identity&&p.identity.weeklyCore?p.identity.weeklyCore:'')]);
      rows.push(['Identity','image', (p.identity&&p.identity.image?p.identity.image:'')]);
      var rolesArr=p.identity && p.identity.roles? p.identity.roles:[]; rolesArr.forEach(function(r){ rows.push(['Identity','role_rule', (r.role||'')+'ï½œ'+(r.rule||'')]); });
      rows.push(['Mirror','online', (p.mirror&&p.mirror.online?p.mirror.online:'')]);
      rows.push(['Mirror','offline', (p.mirror&&p.mirror.offline?p.mirror.offline:'')]);
      return rows.map(function(r){ return r.map(esc).join(','); }).join('\n');
    }
    if(exportBtn){
      exportBtn.addEventListener('click', function(){ if(exportText) exportText.value=buildText(); if(modal) modal.style.display='flex'; if(exportHint) exportHint.textContent=''; });
      if(closeModal) closeModal.addEventListener('click', function(){ if(modal) modal.style.display='none'; });
      if(copyBtn) copyBtn.addEventListener('click', function(){
        try{ navigator.clipboard.writeText(exportText.value); if(exportHint) exportHint.textContent='ï¼ˆå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼‰'; }catch(e){ if(exportHint) exportHint.textContent='ï¼ˆè¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•å…¨é¸ï¼‰'; }
      });
      var dlTxtUtf8=$('#dlTxtUtf8'), dlTxtBom=$('#dlTxtBom'), dlMd=$('#dlMd'), dlCsv=$('#dlCsv');
      if(dlTxtUtf8) dlTxtUtf8.addEventListener('click', function(){ downloadBlob(exportText.value, 'Overexposed_Reading_Log_utf8.txt', 'text/plain;charset=utf-8'); });
      if(dlTxtBom) dlTxtBom.addEventListener('click', function(){
        var bom=new Uint8Array([0xEF,0xBB,0xBF]); var blob=new Blob([bom, exportText.value], {type:'text/plain;charset=utf-8'}); var url=URL.createObjectURL(blob);
        var a=document.createElement('a'); a.href=url; a.download='Overexposed_Reading_Log_utf8_BOM.txt'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(function(){ URL.revokeObjectURL(url); },1000);
      });
      if(dlMd) dlMd.addEventListener('click', function(){ downloadBlob(toMarkdown(), 'Overexposed_Reading_Log.md', 'text/markdown;charset=utf-8'); });
      if(dlCsv) dlCsv.addEventListener('click', function(){ downloadBlob(toCSV(), 'Overexposed_Reading_Log.csv', 'text/csv;charset=utf-8'); });
    }
  }

  document.addEventListener('DOMContentLoaded', function(){
    /* initBar removed (already handled by Chart.js init) */
    bindTagWall();
    bindGuideButtons();
    activateTab('tab1'); // default
    bindExport();
  });

  // Clear all
  document.addEventListener('click', function(e){
    var target=e.target; if(target && target.id==='clearAllBtn'){
      if(!confirm('ç¢ºå®šæ¸…é™¤æœ¬æ©Ÿæ‰€æœ‰æš«å­˜è³‡æ–™ï¼Ÿï¼ˆæ¨™ç±¤ç‰†ã€åè½‰ç´€éŒ„ã€ä¸‰å±¤èªåŒã€æ¿¾é¡å·®è·ï¼‰')) return;
      localStorage.removeItem('tags'); localStorage.removeItem('flips'); localStorage.removeItem('identity'); localStorage.removeItem('mirror'); alert('å·²æ¸…é™¤ã€‚'); location.reload();
    }
  });
})();
</script>
</body>
</html>

